* Latency under load Tests
  This is a collection of tests run against a cerowrt router, from a laptop with a e1000e network card, with byte queue limits.

* Default 10 iperfs
This is 10 iperfs, along with a ping, over a 100Mbit network, with a
txqueuelen of 1000, and pfifo_fast, running for 20 seconds total, with
iperf running for 10. I should re-run this for 100 seconds, total.

GSO, TSO off
Tx ring of 64

Byte Queue Limits are set to 4500.

#+PLOT: ind:1 type:2d title:"Latency under Load" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 | 172.30.48.1 | 127.0.0.1 |
|----+-------------+-------------+-----------|
|  1 |        0.45 |        0.31 |      0.05 |
|  2 |        0.48 |        0.31 |      0.06 |
|  3 |       16.82 |       14.45 |      0.04 |
|  4 |       34.34 |       34.58 |      0.07 |
|  5 |       45.19 |       46.19 |      0.04 |
|  6 |       42.47 |       44.30 |      0.10 |
|  7 |       46.87 |       48.38 |      0.07 |
|  8 |       51.66 |       53.68 |      0.07 |
|  9 |       56.58 |       40.19 |      0.08 |
| 10 |       44.00 |       45.24 |      0.07 |
| 11 |       52.55 |       53.52 |      0.04 |
| 12 |       41.76 |       43.42 |      0.07 |
| 13 |        0.49 |        0.33 |      0.07 |
| 14 |        0.44 |        0.42 |      0.07 |
| 15 |        0.30 |        0.23 |      0.07 |
| 16 |        0.45 |        0.32 |      0.06 |
| 17 |        0.41 |        0.27 |      0.04 |
| 18 |        0.31 |        0.49 |      0.06 |
| 19 |        0.40 |        0.30 |      0.06 |
| 20 |        6.29 |        0.33 |      0.07 |

#+results:

#+attr_html: width="800"

* 1 Iperf, 100Mbit Basic Latency under load Test, 60 seconds

This is 1 iperfs, along with 2 fping, over a 100Mbit network, with a
txqueuelen of 1000, and pfifo_fast, running for 60 seconds total, with
iperf running for 50. Tx ring of 64

Byte Queue Limits are set to 4500.

(To say gnuplot is finicky is an understatement)

#+PLOT: ind:1 type:2d title:"Latency under Load" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 | 172.30.48.1 |
|----+-------------+-------------|
|  1 |        0.50 |        0.33 |
|  2 |        0.56 |        0.30 |
|  3 |        0.30 |        0.28 |
|  4 |        0.48 |        0.35 |
|  5 |        0.31 |        0.30 |
|  6 |       10.47 |       11.99 |
|  7 |       10.82 |       10.55 |
|  8 |       12.84 |       12.24 |
|  9 |       10.57 |       11.97 |
| 10 |       12.37 |       11.49 |
| 11 |       12.12 |       12.50 |
| 12 |       11.27 |       12.51 |
| 13 |       13.08 |       11.73 |
| 14 |       10.52 |       11.23 |
| 15 |       12.47 |       11.77 |
| 16 |       14.65 |       12.48 |
| 17 |       10.09 |       10.23 |
| 18 |       13.26 |       11.46 |
| 19 |       11.65 |       12.01 |
| 20 |       11.33 |       11.98 |
| 21 |       13.65 |       11.72 |
| 22 |       10.28 |       13.06 |
| 23 |       12.85 |       11.24 |
| 24 |       10.99 |       11.97 |
| 25 |       10.28 |       11.73 |
| 26 |       10.00 |       12.01 |
| 27 |       11.84 |       12.23 |
| 28 |       12.54 |        5.58 |
| 29 |       11.43 |       10.72 |
| 30 |       10.47 |       12.24 |
| 31 |       13.56 |       11.80 |
| 32 |       12.30 |       12.01 |
| 33 |       12.30 |       11.02 |
| 34 |       12.46 |       13.04 |
| 35 |        9.87 |       12.74 |
| 36 |       13.23 |       13.03 |
| 37 |       13.99 |       11.03 |
| 38 |       12.55 |       11.90 |
| 39 |       14.89 |       13.45 |
| 40 |       13.52 |       12.72 |
| 41 |       11.43 |       11.70 |
| 42 |       11.16 |       11.48 |
| 43 |       10.87 |       11.00 |
| 44 |       14.48 |       11.00 |
| 45 |       11.79 |       11.79 |
| 46 |       11.03 |       11.75 |
| 47 |       12.83 |       11.25 |
| 48 |       14.60 |       11.99 |
| 49 |       11.10 |       12.27 |
| 50 |        9.95 |       11.30 |
| 51 |       14.20 |       12.26 |
| 52 |       12.87 |       12.25 |
| 53 |       14.80 |       10.56 |
| 54 |       10.31 |       12.25 |
| 55 |        0.33 |        0.21 |
| 56 |        0.39 |        0.25 |
| 57 |        0.31 |        0.32 |
| 58 |        0.31 |        0.35 |
| 59 |        0.29 |        0.35 |
| 60 |        0.50 |        0.32 |

** Latency under load Test, 60 seconds, 10 iperfs

This is 10 iperfs, along with 2 fping, over a 100Mbit network, with a
txqueuelen of 1000, and pfifo_fast, running for 60 seconds total, with
iperf running for 50. Tx ring of 64

Byte Queue Limits are set to 4500.

#+PLOT: ind:1 type:2d title:"100Mbit Latency under Load - PFIFO_FAST, 1000 txqueuelen 10 iperfs, 2 pings" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 | 172.30.48.1 |
|----+-------------+-------------|
|  1 |        0.47 |        0.29 |
|  2 |        0.42 |        0.27 |
|  3 |        0.51 |        0.44 |
|  4 |        0.34 |        0.29 |
|  5 |        0.51 |        0.33 |
|  6 |       42.87 |       44.26 |
|  7 |       92.74 |       92.19 |
|  8 |      106.22 |      109.44 |
|  9 |      109.85 |      108.23 |
| 10 |      108.34 |      109.47 |
| 11 |      108.81 |      105.99 |
| 12 |      109.15 |      105.52 |
| 13 |      109.01 |      109.66 |
| 14 |      107.30 |      109.17 |
| 15 |      109.99 |      106.35 |
| 16 |      108.91 |      104.81 |
| 17 |      106.96 |      108.11 |
| 18 |      107.15 |      108.81 |
| 19 |      104.27 |      104.17 |
| 20 |      105.45 |      107.03 |
| 21 |      105.96 |      108.03 |
| 22 |      104.66 |      105.39 |
| 23 |      109.02 |      110.66 |
| 24 |      108.88 |      109.76 |
| 25 |      104.89 |      105.07 |
| 26 |      107.17 |      108.83 |
| 27 |      105.60 |      107.49 |
| 28 |      110.58 |      105.87 |
| 29 |      111.85 |      108.29 |
| 30 |      108.74 |      110.87 |
| 31 |      109.05 |      110.67 |
| 32 |      107.59 |      108.30 |
| 33 |      108.09 |      108.12 |
| 34 |      108.13 |      109.57 |
| 35 |      107.70 |      108.57 |
| 36 |      103.03 |      104.14 |
| 37 |      110.58 |      106.67 |
| 38 |      106.48 |      107.90 |
| 39 |      106.27 |      107.21 |
| 40 |      107.41 |      109.31 |
| 41 |      104.01 |      105.04 |
| 42 |      111.26 |      107.23 |
| 43 |      106.83 |      108.77 |
| 44 |      107.83 |      104.01 |
| 45 |      107.00 |      107.41 |
| 46 |      106.64 |      108.56 |
| 47 |      107.98 |      109.50 |
| 48 |      111.58 |      107.76 |
| 49 |      106.11 |      107.76 |
| 50 |      111.93 |      108.32 |
| 51 |      104.87 |      106.01 |
| 52 |      108.31 |      109.72 |
| 53 |      107.35 |      107.74 |
| 54 |      109.84 |      110.53 |
| 55 |      111.44 |      108.03 |
| 56 |        0.30 |        0.30 |
| 57 |        0.36 |        0.31 |
| 58 |        0.56 |        0.52 |
| 59 |        0.36 |        0.24 |
| 60 |        0.29 |        0.31 |

** Latency under load Test, SFQ, 60 seconds

This is 10 iperfs, along with 2 fping, over a 100Mbit network, with a
txqueuelen of 1000, and SFQ on the host, running for 60 seconds total, with
iperf running for 50. Tx ring of 64

Byte Queue Limits are set to 4500.

#+PLOT: ind:1 type:2d title:"100Mbit Latency under Load - w/SFQ 10 iperfs, 2 pings" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 | 172.30.48.1 |
|----+-------------+-------------|
|  1 |        0.47 |        0.34 |
|  2 |        0.44 |        0.31 |
|  3 |        0.33 |        0.30 |
|  4 |        0.38 |        0.31 |
|  5 |        2.75 |        2.72 |
|  6 |        2.74 |        2.77 |
|  7 |        2.78 |        3.07 |
|  8 |        2.84 |        2.72 |
|  9 |        2.55 |        2.85 |
| 10 |        3.04 |        2.64 |
| 11 |        2.79 |        2.64 |
| 12 |        2.64 |        2.68 |
| 13 |        2.78 |        2.94 |
| 14 |        2.81 |        2.95 |
| 15 |        2.58 |        2.91 |
| 16 |        2.87 |        2.94 |
| 17 |        2.79 |        2.74 |
| 18 |        2.82 |        2.86 |
| 19 |        2.88 |        3.01 |
| 20 |        2.97 |        2.90 |
| 21 |        2.71 |        2.85 |
| 22 |        2.88 |        2.70 |
| 23 |        2.98 |        2.98 |
| 24 |        2.67 |        2.72 |
| 25 |        3.02 |        2.78 |
| 26 |        2.70 |        2.88 |
| 27 |        2.97 |        2.63 |
| 28 |        2.75 |        2.73 |
| 29 |        2.74 |        2.69 |
| 30 |        2.88 |        2.81 |
| 31 |        3.02 |        2.83 |
| 32 |        3.04 |        2.92 |
| 33 |        2.76 |        2.85 |
| 34 |        2.96 |        2.80 |
| 35 |        2.91 |        2.96 |
| 36 |        2.85 |        2.85 |
| 37 |        2.81 |        2.73 |
| 38 |        2.83 |        2.73 |
| 39 |        3.15 |        2.65 |
| 40 |        2.86 |        2.67 |
| 41 |        2.97 |        2.94 |
| 42 |        2.78 |        2.75 |
| 43 |        3.01 |        2.62 |
| 44 |        2.63 |        2.82 |
| 45 |        2.86 |        2.95 |
| 46 |        2.94 |        2.75 |
| 47 |        2.71 |        2.68 |
| 48 |        2.89 |        2.97 |
| 49 |        2.94 |        2.65 |
| 50 |        2.73 |        2.64 |
| 51 |        2.99 |        2.99 |
| 52 |        2.88 |        2.75 |
| 53 |        3.01 |        2.70 |
| 54 |        2.59 |        2.98 |
| 55 |        0.35 |        0.24 |
| 56 |        0.53 |        0.56 |
| 57 |        0.54 |        0.38 |
| 58 |        0.32 |        0.42 |
| 59 |        0.33 |        0.30 |
| 60 |        0.34 |        0.34 |

** Latency under load Test, QFQ, 60 seconds

This is 10 iperfs, along with 2 fping, over a 100Mbit network, with a
txqueuelen of 1000, and QFQ on the host, running for 60 seconds total, with
iperf running for 50. Tx ring of 64

Byte Queue Limits are set to 4500.

#+PLOT: ind:1 type:2d title:"100Mbit Latency under Load - w/QFQ 10 iperfs, 2 pings" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 | 172.30.48.1 |
|----+-------------+-------------|
|  1 |        0.33 |        0.32 |
|  2 |        0.50 |        0.32 |
|  3 |        0.33 |        0.29 |
|  4 |        1.57 |        1.66 |
|  5 |        1.57 |        1.44 |
|  6 |        1.64 |        1.73 |
|  7 |        1.68 |        1.58 |
|  8 |        1.81 |        1.69 |
|  9 |        1.41 |        1.65 |
| 10 |        1.63 |        1.62 |
| 11 |        1.60 |        1.59 |
| 12 |        1.55 |        1.68 |
| 13 |        1.69 |        1.83 |
| 14 |        1.46 |        1.57 |
| 15 |        1.72 |        1.58 |
| 16 |        1.77 |        1.82 |
| 17 |        1.72 |        1.83 |
| 18 |        1.65 |        1.62 |
| 19 |        1.75 |        1.57 |
| 20 |        1.86 |        1.65 |
| 21 |        1.59 |        1.63 |
| 22 |        1.70 |        1.70 |
| 23 |        1.78 |        1.76 |
| 24 |        1.75 |        1.78 |
| 25 |        1.71 |        1.70 |
| 26 |        1.64 |        1.68 |
| 27 |        1.60 |        1.70 |
| 28 |        1.63 |        1.71 |
| 29 |        1.69 |        1.72 |
| 30 |        1.55 |        1.72 |
| 31 |        1.75 |        1.78 |
| 32 |        1.57 |        1.74 |
| 33 |        1.68 |        1.76 |
| 34 |        1.56 |        1.62 |
| 35 |        1.71 |        1.65 |
| 36 |        1.78 |        1.69 |
| 37 |        1.75 |        1.67 |
| 38 |        1.69 |        1.74 |
| 39 |        1.67 |        1.64 |
| 40 |        1.77 |        1.47 |
| 41 |        1.73 |        1.70 |
| 42 |        1.65 |        1.70 |
| 43 |        1.72 |        1.87 |
| 44 |        1.76 |        1.91 |
| 45 |        1.62 |        1.62 |
| 46 |        1.67 |        1.69 |
| 47 |        1.52 |        1.74 |
| 48 |        1.55 |        1.71 |
| 49 |        1.76 |        1.80 |
| 50 |        1.65 |        1.70 |
| 51 |        1.48 |        1.59 |
| 52 |        1.84 |        1.43 |
| 53 |        1.70 |        1.58 |
| 54 |        0.37 |        0.26 |
| 55 |        0.47 |        0.44 |
| 56 |        0.37 |        0.27 |
| 57 |        0.25 |        0.29 |
| 58 |        0.26 |        0.34 |
| 59 |        0.35 |        0.27 |
| 60 |        0.33 |        0.26 |

** Latency under load Test, QFQ vs SFQ, 60 seconds

This is 10 iperfs, along with 2 fping, over a 100Mbit network, with a
txqueuelen of 1000, vs QFQ and SFQ on the host, running for 60 seconds total, with
iperf running for 50. Tx ring of 64

Byte Queue Limits are set to 4500.

I note that the buffer size on QFQ is set to 24 pfifo per bin.

SFQ has a hard limit of 127 packets. This may or may not account for the difference in plots

#+PLOT: ind:1 type:2d title:"100 Mbit Latency under Load - QFQ vs SFQ - 10 iperfs, 2 pings" set:"yrange [0:]" set:"ylabel 'RTT MS'"
|  T | 172.30.50.1 QFQ | 172.30.48.1 QFQ | 172.30.50.1 SFQ | 172.30.48.1 SFQ |
|----+-----------------+-----------------+-----------------+-----------------|
|  1 |            0.33 |            0.32 |            0.47 |            0.34 |
|  2 |            0.50 |            0.32 |            0.44 |            0.31 |
|  3 |            0.33 |            0.29 |            0.33 |            0.30 |
|  4 |            1.57 |            1.66 |            0.38 |            0.31 |
|  5 |            1.57 |            1.44 |            2.75 |            2.72 |
|  6 |            1.64 |            1.73 |            2.74 |            2.77 |
|  7 |            1.68 |            1.58 |            2.78 |            3.07 |
|  8 |            1.81 |            1.69 |            2.84 |            2.72 |
|  9 |            1.41 |            1.65 |            2.55 |            2.85 |
| 10 |            1.63 |            1.62 |            3.04 |            2.64 |
| 11 |            1.60 |            1.59 |            2.79 |            2.64 |
| 12 |            1.55 |            1.68 |            2.64 |            2.68 |
| 13 |            1.69 |            1.83 |            2.78 |            2.94 |
| 14 |            1.46 |            1.57 |            2.81 |            2.95 |
| 15 |            1.72 |            1.58 |            2.58 |            2.91 |
| 16 |            1.77 |            1.82 |            2.87 |            2.94 |
| 17 |            1.72 |            1.83 |            2.79 |            2.74 |
| 18 |            1.65 |            1.62 |            2.82 |            2.86 |
| 19 |            1.75 |            1.57 |            2.88 |            3.01 |
| 20 |            1.86 |            1.65 |            2.97 |            2.90 |
| 21 |            1.59 |            1.63 |            2.71 |            2.85 |
| 22 |            1.70 |            1.70 |            2.88 |            2.70 |
| 23 |            1.78 |            1.76 |            2.98 |            2.98 |
| 24 |            1.75 |            1.78 |            2.67 |            2.72 |
| 25 |            1.71 |            1.70 |            3.02 |            2.78 |
| 26 |            1.64 |            1.68 |            2.70 |            2.88 |
| 27 |            1.60 |            1.70 |            2.97 |            2.63 |
| 28 |            1.63 |            1.71 |            2.75 |            2.73 |
| 29 |            1.69 |            1.72 |            2.74 |            2.69 |
| 30 |            1.55 |            1.72 |            2.88 |            2.81 |
| 31 |            1.75 |            1.78 |            3.02 |            2.83 |
| 32 |            1.57 |            1.74 |            3.04 |            2.92 |
| 33 |            1.68 |            1.76 |            2.76 |            2.85 |
| 34 |            1.56 |            1.62 |            2.96 |            2.80 |
| 35 |            1.71 |            1.65 |            2.91 |            2.96 |
| 36 |            1.78 |            1.69 |            2.85 |            2.85 |
| 37 |            1.75 |            1.67 |            2.81 |            2.73 |
| 38 |            1.69 |            1.74 |            2.83 |            2.73 |
| 39 |            1.67 |            1.64 |            3.15 |            2.65 |
| 40 |            1.77 |            1.47 |            2.86 |            2.67 |
| 41 |            1.73 |            1.70 |            2.97 |            2.94 |
| 42 |            1.65 |            1.70 |            2.78 |            2.75 |
| 43 |            1.72 |            1.87 |            3.01 |            2.62 |
| 44 |            1.76 |            1.91 |            2.63 |            2.82 |
| 45 |            1.62 |            1.62 |            2.86 |            2.95 |
| 46 |            1.67 |            1.69 |            2.94 |            2.75 |
| 47 |            1.52 |            1.74 |            2.71 |            2.68 |
| 48 |            1.55 |            1.71 |            2.89 |            2.97 |
| 49 |            1.76 |            1.80 |            2.94 |            2.65 |
| 50 |            1.65 |            1.70 |            2.73 |            2.64 |
| 51 |            1.48 |            1.59 |            2.99 |            2.99 |
| 52 |            1.84 |            1.43 |            2.88 |            2.75 |
| 53 |            1.70 |            1.58 |            3.01 |            2.70 |
| 54 |            0.37 |            0.26 |            2.59 |            2.98 |
| 55 |            0.47 |            0.44 |            0.35 |            0.24 |
| 56 |            0.37 |            0.27 |            0.53 |            0.56 |
| 57 |            0.25 |            0.29 |            0.54 |            0.38 |
| 58 |            0.26 |            0.34 |            0.32 |            0.42 |
| 59 |            0.35 |            0.27 |            0.33 |            0.30 |
| 60 |            0.33 |            0.26 |            0.34 |            0.34 |

* GSO/TSO tests (100Mbit)
** PFIFO_FAST
*** TSO/GSO Enabled
*** GSO Enabled
*** TSO/GSO Disabled
*** Comparison
** SFQ
*** TSO/GSO Enabled
*** GSO Enabled
*** TSO/GSO Disabled

*** Comparison
** QFQ
*** TSO/GSO Enabled
*** GSO Enabled
*** TSO/GSO Disabled

*** Comparison

* TCP_RR
 
